<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>ä¸€å¹´çº§ç”Ÿå­—æœ¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    font-family: "Microsoft YaHei", sans-serif;
    background: #fff3e0;
    padding: 0;
    margin: 0;
  }

  .container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0;
  }

  /* å“åº”å¼å¸ƒå±€ */
  @media (max-width: 480px) {
    /* æ‰‹æœºç«¯ï¼š3 ä¸ªç”Ÿå­— */
    #list {
      grid-template-columns: repeat(3, 1fr);
    }
    
    .container {
      max-width: 100%;
    }
  }

  @media (min-width: 481px) and (max-width: 768px) {
    /* å¹³æ¿ï¼š4 ä¸ªç”Ÿå­— */
    #list {
      grid-template-columns: repeat(4, 1fr);
    }
    .container {
      max-width: 100%;
    }
  }

  @media (min-width: 769px) {
    /* æ¡Œé¢ï¼š5 ä¸ªç”Ÿå­— */
    #list {
      grid-template-columns: repeat(5, 1fr);
    }
    .container {
      max-width: 100%;
    }
  }

  /* ç™»å½•/æ³¨å†Œé¡µé¢ */
  /* ç™»å½•/æ³¨å†Œé¡µé¢å®¹å™¨ */
  #auth-page {
    display: none;
    min-height: 100vh;
    background: linear-gradient(135deg, #ff6f61 0%, #ffb88c 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0;
    padding: 16px;
    width: 100%;
  }

  .auth-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    width: 100%;
    max-width: 900px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    background: white;
    min-height: 500px;
  }

  .auth-panel {
    display: none;
    flex-direction: column;
    justify-content: center;
    padding: 48px 40px;
  }

  .auth-panel.active {
    display: flex;
  }

  .auth-panel h2 {
    text-align: center;
    color: #ff6f61;
    margin: 0 0 12px 0;
    font-size: 28px;
  }

  .auth-panel .subtitle {
    text-align: center;
    color: #999;
    font-size: 14px;
    margin-bottom: 32px;
  }

  .auth-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .form-group label {
    font-size: 14px;
    color: #666;
    font-weight: 500;
  }

  .form-group input {
    padding: 12px 16px;
    border: 2px solid #eee;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.2s;
  }

  .form-group input:focus {
    outline: none;
    border-color: #ff6f61;
  }

  .form-group input::placeholder {
    color: #bbb;
  }

  .auth-submit-btn {
    padding: 12px 16px;
    background: #ff6f61;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
    margin-top: 8px;
  }

  .auth-submit-btn:hover {
    background: #ff3b2f;
  }

  .auth-submit-btn:active {
    transform: scale(0.98);
  }

  .auth-toggle {
    text-align: center;
    margin-top: 24px;
    font-size: 14px;
    color: #666;
  }

  .auth-toggle a {
    color: #ff6f61;
    cursor: pointer;
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s;
  }

  .auth-toggle a:hover {
    color: #ff3b2f;
  }

  .auth-side {
    background: linear-gradient(135deg, #ff6f61 0%, #ffb88c 100%);
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 48px 40px;
    text-align: center;
  }

  .auth-side h3 {
    font-size: 32px;
    margin: 0 0 16px 0;
  }

  .auth-side p {
    font-size: 16px;
    margin: 0;
    line-height: 1.6;
    opacity: 0.9;
  }

  .auth-error {
    padding: 12px 16px;
    background: #ffebee;
    color: #c62828;
    border-radius: 8px;
    font-size: 14px;
    display: none;
    margin-bottom: 16px;
  }

  .auth-error.show {
    display: block;
  }

  /* ç§»åŠ¨ç«¯å“åº”å¼ */
  @media (max-width: 768px) {
    .auth-container {
      grid-template-columns: 1fr;
    }

    .auth-side {
      display: none;
    }

    .auth-panel {
      padding: 32px 24px;
    }

    .auth-panel h2 {
      font-size: 24px;
    }
  }

  /* å¯¼èˆªæ  */
  .navbar {
    background: #ff6f61;
    color: white;
    padding: 12px 16px;
    margin: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .navbar h1 {
    margin: 0;
    font-size: 20px;
    flex: 1;
  }

  .user-menu-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    position: relative;
    transition: background 0.2s;
  }

  .user-menu-btn:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .user-menu {
    display: none;
    position: absolute;
    top: 50px;
    right: 16px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 100;
    min-width: 180px;
  }

  .user-menu.show {
    display: block;
  }

  .user-menu-item {
    padding: 12px 16px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background 0.2s;
    color: #333;
  }

  .user-menu-item:last-child {
    border-bottom: none;
  }

  .user-menu-item:hover {
    background: #f5f5f5;
  }

  .user-info-item {
    padding: 12px 16px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
    color: #666;
  }

  /* åŠŸèƒ½èœå•å¯¼èˆª */
  .feature-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin: 0;
    padding: 16px;
    background: white;
    border-bottom: 1px solid #eee;
    width: 100%;
  }

  .feature-nav > div {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
    width: 100%;
  }

  .feature-btn {
    padding: 10px 14px;
    border: 2px solid #ddd;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
    text-align: center;
    font-weight: 500;
    flex-shrink: 0;
  }

  .feature-btn:hover {
    border-color: #ff6f61;
    color: #ff6f61;
  }

  .feature-btn.active {
    background: #ff6f61;
    color: white;
    border-color: #ff6f61;
  }

  /* å­èœå•æ ·å¼ */
  .submenu {
    display: flex;
    flex-direction: column;
    min-width: 120px !important;
  }

  .submenu-item {
    padding: 10px 14px;
    background: white;
    border: none;
    border-bottom: 1px solid #f0f0f0;
    cursor: pointer;
    text-align: left;
    font-size: 13px;
    transition: background 0.2s;
    color: #333;
  }

  .submenu-item:last-child {
    border-bottom: none;
  }

  .submenu-item:hover {
    background: #f5f5f5;
  }

  .submenu-item.active {
    background: #ffe0d6;
    color: #ff6f61;
    font-weight: bold;
  }

  /* iframe å®¹å™¨ */
  #contentFrame {
    width: 100%;
    height: 100vh;
    border: none;
    background: #fff3e0;
    display: block;
  }
  
  #app-page {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  
  #app-page > .navbar {
    flex-shrink: 0;
  }
  
  #app-page > .feature-nav {
    flex-shrink: 0;
  }
  
  #contentFrame {
    flex: 1;
    overflow-y: auto;
  }

  .word-info .speak-count {
    display: block;
    color: #ff6f61;
    font-weight: bold;
  }

  .word-actions {
    display: flex;
    gap: 4px;
    width: 100%;
  }

  .word-actions button {
    flex: 1;
    padding: 6px;
    border: none;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .speak-btn {
    background: #4caf50;
    color: white;
  }

  .speak-btn:hover {
    background: #45a049;
  }

  .del-btn {
    background: #ff6f61;
    color: white;
  }

  .del-btn:hover {
    background: #ff3b2f;
  }

  /* è¾“å…¥åŒºåŸŸ */
  #input-area {
    display: flex;
    gap: 8px;
    margin-top: 8px;
  }

  #input-area input {
    flex-grow: 1;
    padding: 10px 12px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ddd;
  }

  #input-area button {
    width: 100px;
    background-color: #ff6f61;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  #input-area button:hover {
    background-color: #ff3b2f;
  }

  /* æµ®åŠ¨æŒ‰é’® */
  .fab {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: #ff6f61;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 28px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(255, 111, 97, 0.4);
    display: none;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s, box-shadow 0.2s;
    z-index: 50;
  }

  .fab:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(255, 111, 97, 0.6);
  }

  .fab.show {
    display: flex;
  }

  /* æ¨¡æ€æ¡† */
  .modal {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    animation: fadeIn 0.3s;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal.show {
    display: flex;
    align-items: flex-end;
  }

  .modal-content {
    background: white;
    width: 100%;
    padding: 24px 16px;
    border-radius: 16px 16px 0 0;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    animation: slideUp 0.3s;
  }

  @keyframes slideUp {
    from {
      transform: translateY(100%);
    }
    to {
      transform: translateY(0);
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .modal-header h3 {
    margin: 0;
    color: #ff6f61;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #999;
  }

  .modal-close:hover {
    color: #ff6f61;
  }

  .modal-input-area {
    display: flex;
    gap: 8px;
  }

  .modal-input-area input {
    flex-grow: 1;
    padding: 12px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ddd;
  }

  .modal-input-area button {
    width: 80px;
    background-color: #ff6f61;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .modal-input-area button:hover {
    background-color: #ff3b2f;
  }

  /* å‘éŸ³è®¾ç½®é¢æ¿ */
  .pronunciation-settings {
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-height: 70vh;
    overflow-y: auto;
  }

  .pronunciation-type {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 16px;
    background: linear-gradient(135deg, #fff9f0 0%, #fff3e0 100%);
    border-radius: 12px;
    border-left: 4px solid #ff6f61;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .pronunciation-type-label {
    font-weight: bold;
    font-size: 15px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .pronunciation-type-label::before {
    content: '';
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: #ff6f61;
  }

  .speed-buttons {
    display: flex;
    gap: 8px;
  }

  .speed-btn {
    flex: 1;
    padding: 10px 12px;
    border: 2px solid #ddd;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: #666;
  }

  .speed-btn:hover {
    border-color: #ff6f61;
    color: #ff6f61;
    transform: translateY(-2px);
    box-shadow: 0 2px 6px rgba(255, 111, 97, 0.2);
  }

  .speed-btn.active {
    background: linear-gradient(135deg, #ff6f61 0%, #ff8575 100%);
    color: white;
    border-color: #ff6f61;
    box-shadow: 0 4px 12px rgba(255, 111, 97, 0.3);
  }

  .pronunciation-test {
    margin-top: 4px;
    padding: 12px;
    background: white;
    border-radius: 8px;
    text-align: center;
    font-size: 12px;
    color: #999;
  }

  .pronunciation-test button {
    margin-top: 8px;
    padding: 8px 16px;
    background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
    box-shadow: 0 2px 6px rgba(76, 175, 80, 0.2);
  }

  .pronunciation-test button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
  }

  .pronunciation-test button:active {
    transform: translateY(0);
  }

  .voice-select {
    width: 100%;
    padding: 10px 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 13px;
    background: white;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
    color: #333;
    font-weight: 500;
  }

  .voice-select:hover {
    border-color: #ff6f61;
    box-shadow: 0 2px 6px rgba(255, 111, 97, 0.15);
  }

  .voice-select:focus {
    outline: none;
    border-color: #ff6f61;
    box-shadow: 0 0 0 3px rgba(255, 111, 97, 0.1);
  }
</style>
</head>

<body>
<div class="container">
  <!-- ç™»å½•/æ³¨å†Œé¡µé¢ -->
  <div id="auth-page">
    <div class="auth-container">
      <!-- ç™»å½•é¢æ¿ -->
      <div class="auth-panel active" id="login-panel">
        <h2>ğŸ” ç™»å½•è´¦æˆ·</h2>
        <p class="subtitle">æ¬¢è¿å›æ¥</p>
        <div class="auth-error" id="login-error"></div>
        <form class="auth-form" id="login-form" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="login-username">ç”¨æˆ·å</label>
            <input 
              type="text" 
              id="login-username" 
              placeholder="è¯·è¾“å…¥ç”¨æˆ·å" 
              required
              minlength="3"
            />
          </div>
          <div class="form-group">
            <label for="login-password">å¯†ç </label>
            <input 
              type="password" 
              id="login-password" 
              placeholder="è¯·è¾“å…¥å¯†ç " 
              required
              minlength="6"
            />
          </div>
          <button type="submit" class="auth-submit-btn">ç™»å½•</button>
        </form>
        <div class="auth-toggle">
          è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ<a onclick="switchAuthMode()">ç«‹å³æ³¨å†Œ</a>
        </div>
      </div>

      <!-- æ³¨å†Œé¢æ¿ -->
      <div class="auth-panel" id="register-panel">
        <h2>ğŸ“ æ³¨å†Œè´¦æˆ·</h2>
        <p class="subtitle">åˆ›å»ºæ–°è´¦æˆ·</p>
        <div class="auth-error" id="register-error"></div>
        <form class="auth-form" id="register-form" onsubmit="handleRegister(event)">
          <div class="form-group">
            <label for="register-username">ç”¨æˆ·å</label>
            <input 
              type="text" 
              id="register-username" 
              placeholder="è¯·è¾“å…¥ç”¨æˆ·åï¼ˆè‡³å°‘ 3 ä¸ªå­—ç¬¦ï¼‰" 
              required
              minlength="3"
            />
          </div>
          <div class="form-group">
            <label for="register-password">å¯†ç </label>
            <input 
              type="password" 
              id="register-password" 
              placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘ 6 ä¸ªå­—ç¬¦ï¼‰" 
              required
              minlength="6"
            />
          </div>
          <div class="form-group">
            <label for="register-confirm">ç¡®è®¤å¯†ç </label>
            <input 
              type="password" 
              id="register-confirm" 
              placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " 
              required
              minlength="6"
            />
          </div>
          <button type="submit" class="auth-submit-btn">æ³¨å†Œ</button>
        </form>
        <div class="auth-toggle">
          å·²æœ‰è´¦æˆ·ï¼Ÿ<a onclick="switchAuthMode()">ç«‹å³ç™»å½•</a>
        </div>
      </div>

      <!-- ä¾§è¾¹æ  -->
      <div class="auth-side">
        <h3>ğŸ“š ä¸€å¹´çº§ç”Ÿå­—æœ¬</h3>
        <p>å¸®åŠ©å°æœ‹å‹å­¦ä¹ æ–°çš„æ±‰å­—ï¼Œæé«˜é˜…è¯»èƒ½åŠ›ã€‚åŠ æ²¹ï¼</p>
      </div>
    </div>
  </div>

  <!-- ä¸»åº”ç”¨é¡µé¢ -->
  <div id="app-page">
    <!-- å¯¼èˆªæ  -->
    <div class="navbar">
      <h1 id="pageTitle">å­¦ä¹ å·¥å…·</h1>
      <div style="position: relative;">
        <button class="user-menu-btn" onclick="toggleUserMenu()" id="userMenuBtn">ğŸ‘¤ èœå•</button>
        <div class="user-menu" id="userMenu">
          <div class="user-info-item" id="usernameDisplay"></div>
          <div class="user-menu-item" onclick="openPronunciationSettings()">ğŸ”Š å‘éŸ³è®¾ç½®</div>
          <div class="user-menu-item" onclick="openChangePassword()">ğŸ” ä¿®æ”¹å¯†ç </div>
          <div class="user-menu-item" style="background: #ffebee; color: #ff6f61;" onclick="logout()">ğŸšª é€€å‡ºç™»å½•</div>
        </div>
      </div>
    </div>

    <!-- åŠŸèƒ½èœå• -->
    <div class="feature-nav" id="featureNav">
      <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
        <div style="position: relative;">
          <button class="feature-btn active" onclick="toggleChineseMenu(event)">ğŸ“š è¯­æ–‡</button>
          <div class="submenu" id="chineseSubmenu" style="display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ddd; border-radius: 6px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); z-index: 10; min-width: 120px;">
            <button class="submenu-item active" onclick="switchPage('chinese')">ç”Ÿå­—</button>
            <button class="submenu-item" onclick="switchPage('pinyin')">å£°æ¯éŸµæ¯</button>
          </div>
        </div>
        <button class="feature-btn" onclick="switchPage('math')">ğŸ”¢ æ•°å­¦</button>
        <button class="feature-btn" onclick="switchPage('english')">ğŸ”¤ è‹±è¯­</button>
      </div>
    </div>

    <!-- å†…å®¹å®¹å™¨ - é€šè¿‡ iframe åŠ è½½å„ä¸ªæ¨¡å— -->
    <iframe id="contentFrame" style="width: 100%; border: none; background: #fff3e0; min-height: 400px;" src="chinese.html"></iframe>
  </div>
</div>

<!-- æµ®åŠ¨æŒ‰é’® -->
<button class="fab show" onclick="openAddItemModal()" id="fabBtn">â•</button>

<!-- æ·»åŠ å†…å®¹æ¨¡æ€æ¡† -->
<div class="modal" id="addItemModal" onclick="closeAddItemModal(event)">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h3 id="modalTitle">æ·»åŠ å†…å®¹</h3>
      <button class="modal-close" onclick="closeAddItemModal()">âœ•</button>
    </div>
    <div class="modal-input-area" id="modalInputArea">
      <!-- æ ¹æ®ä¸åŒé¡µé¢åŠ¨æ€æ”¹å˜ -->
    </div>
  </div>
</div>

<!-- å‘éŸ³è®¾ç½®æ¨¡æ€æ¡† -->
<div class="modal" id="pronunciationModal" onclick="closePronunciationSettings(event)">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h3>ğŸ”Š å‘éŸ³è®¾ç½®</h3>
      <button class="modal-close" onclick="closePronunciationSettings()">âœ•</button>
    </div>
    <div class="pronunciation-settings">
      <!-- ä¸­æ–‡å‘éŸ³ -->
      <div class="pronunciation-type">
        <div class="pronunciation-type-label">ğŸ“– ä¸­æ–‡å‘éŸ³</div>
        
        <div style="margin-bottom: 12px;">
          <div style="font-size: 12px; font-weight: 600; color: #555; margin-bottom: 8px;">ğŸ¤ é€‰æ‹©å‘éŸ³äººï¼š</div>
          <select id="chineseVoiceSelect" class="voice-select" onchange="setVoiceUI('chinese', this.value)">
            <option value="">åŠ è½½ä¸­...</option>
          </select>
        </div>

        <div style="margin-bottom: 8px;">
          <div style="font-size: 12px; font-weight: 600; color: #555; margin-bottom: 8px;">âš¡ è°ƒæ•´é€Ÿåº¦ï¼š</div>
          <div class="speed-buttons">
            <button class="speed-btn" onclick="setPronunciationSpeedUI('chinese', 'slow')">ğŸ¢ å¾ˆæ…¢</button>
            <button class="speed-btn active" onclick="setPronunciationSpeedUI('chinese', 'normal')">ğŸ¯ æ­£å¸¸</button>
            <button class="speed-btn" onclick="setPronunciationSpeedUI('chinese', 'fast')">ğŸš€ å¿«é€Ÿ</button>
          </div>
        </div>

        <div class="pronunciation-test">
          <div style="margin-bottom: 8px; font-weight: 600; color: #555;">ğŸ”Š è¯•å¬æ•ˆæœï¼š</div>
          <button onclick="testPronunciation('ä½ å¥½ï¼Œä¸­æ–‡å‘éŸ³', 'chinese')">â–¶ è¯•å¬ä¸­æ–‡</button>
        </div>
      </div>

      <!-- æ‹¼éŸ³å‘éŸ³ -->
      <div class="pronunciation-type">
        <div class="pronunciation-type-label">ğŸ”¤ æ‹¼éŸ³å‘éŸ³</div>
        
        <div style="margin-bottom: 12px;">
          <div style="font-size: 12px; font-weight: 600; color: #555; margin-bottom: 8px;">ğŸ¤ é€‰æ‹©å‘éŸ³äººï¼š</div>
          <select id="pinyinVoiceSelect" class="voice-select" onchange="setVoiceUI('pinyin', this.value)">
            <option value="">åŠ è½½ä¸­...</option>
          </select>
        </div>

        <div style="margin-bottom: 8px;">
          <div style="font-size: 12px; font-weight: 600; color: #555; margin-bottom: 8px;">âš¡ è°ƒæ•´é€Ÿåº¦ï¼š</div>
          <div class="speed-buttons">
            <button class="speed-btn" onclick="setPronunciationSpeedUI('pinyin', 'slow')">ğŸ¢ å¾ˆæ…¢</button>
            <button class="speed-btn active" onclick="setPronunciationSpeedUI('pinyin', 'normal')">ğŸ¯ æ­£å¸¸</button>
            <button class="speed-btn" onclick="setPronunciationSpeedUI('pinyin', 'fast')">ğŸš€ å¿«é€Ÿ</button>
          </div>
        </div>

        <div class="pronunciation-test">
          <div style="margin-bottom: 8px; font-weight: 600; color: #555;">ğŸ”Š è¯•å¬æ•ˆæœï¼š</div>
          <button onclick="testPronunciation('å…«', 'pinyin')">â–¶ è¯•å¬æ‹¼éŸ³</button>
        </div>
      </div>

      <!-- è‹±æ–‡å‘éŸ³ -->
      <div class="pronunciation-type">
        <div class="pronunciation-type-label">ğŸŒ è‹±æ–‡å‘éŸ³</div>
        
        <div style="margin-bottom: 12px;">
          <div style="font-size: 12px; font-weight: 600; color: #555; margin-bottom: 8px;">ğŸ¤ é€‰æ‹©å‘éŸ³äººï¼š</div>
          <select id="englishVoiceSelect" class="voice-select" onchange="setVoiceUI('english', this.value)">
            <option value="">åŠ è½½ä¸­...</option>
          </select>
        </div>

        <div style="margin-bottom: 8px;">
          <div style="font-size: 12px; font-weight: 600; color: #555; margin-bottom: 8px;">âš¡ è°ƒæ•´é€Ÿåº¦ï¼š</div>
          <div class="speed-buttons">
            <button class="speed-btn" onclick="setPronunciationSpeedUI('english', 'slow')">ğŸ¢ å¾ˆæ…¢</button>
            <button class="speed-btn active" onclick="setPronunciationSpeedUI('english', 'normal')">ğŸ¯ æ­£å¸¸</button>
            <button class="speed-btn" onclick="setPronunciationSpeedUI('english', 'fast')">ğŸš€ å¿«é€Ÿ</button>
          </div>
        </div>

        <div class="pronunciation-test">
          <div style="margin-bottom: 8px; font-weight: 600; color: #555;">ğŸ”Š è¯•å¬æ•ˆæœï¼š</div>
          <button onclick="testPronunciation('Hello, how are you', 'english')">â–¶ è¯•å¬è‹±æ–‡</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let currentUser = null;
let currentPage = "chinese";

// ==================== å…¨å±€å‘éŸ³é…ç½®ç³»ç»Ÿ ====================

// å­˜å‚¨æ‰€æœ‰å¯ç”¨çš„å‘éŸ³äºº
let availableVoices = {
  chinese: [],
  english: []
};

// åˆå§‹åŒ–å‘éŸ³äººåˆ—è¡¨
function initializeVoices() {
  const allVoices = speechSynthesis.getVoices();
  
  // è·å–ä¸­æ–‡å‘éŸ³äºº
  availableVoices.chinese = allVoices.filter(voice => voice.lang.startsWith('zh'));
  
  // è·å–è‹±æ–‡å‘éŸ³äºº
  availableVoices.english = allVoices.filter(voice => voice.lang.startsWith('en'));
  
  // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„
  if (availableVoices.chinese.length === 0) {
    availableVoices.chinese = allVoices;
  }
  if (availableVoices.english.length === 0) {
    availableVoices.english = allVoices;
  }
}

// å½“å‘éŸ³äººåŠ è½½å®Œæˆæ—¶åˆå§‹åŒ–
if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = initializeVoices;
}
initializeVoices();

const PRONUNCIATION_CONFIG = {
  // ä¸­æ–‡å‘éŸ³é…ç½®
  chinese: {
    lang: "zh-CN",
    speeds: {
      slow: 0.5,      // å¾ˆæ…¢
      normal: 0.7,    // æ­£å¸¸
      fast: 0.9       // å¿«é€Ÿ
    },
    currentSpeed: 0.7,
    voiceIndex: 0,    // é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ªå‘éŸ³äºº
    pitch: 1,
    volume: 1
  },
  
  // æ‹¼éŸ³å‘éŸ³é…ç½®
  pinyin: {
    lang: "zh-CN",
    speeds: {
      slow: 0.6,
      normal: 0.8,
      fast: 1.0
    },
    currentSpeed: 0.8,
    voiceIndex: 0,
    pitch: 1,
    volume: 1
  },
  
  // è‹±æ–‡å‘éŸ³é…ç½®
  english: {
    lang: "en-US",
    speeds: {
      slow: 0.6,
      normal: 0.8,
      fast: 1.0
    },
    currentSpeed: 0.8,
    voiceIndex: 0,
    pitch: 1,
    volume: 1
  }
};

// è·å–å¯¹åº”ç±»å‹çš„å‘éŸ³äººåˆ—è¡¨
function getVoicesForType(type) {
  if (type === 'pinyin') {
    return availableVoices.chinese;
  } else if (type === 'english') {
    return availableVoices.english;
  }
  return availableVoices.chinese;
}

// è·å–å‘éŸ³äººåç§°
function getVoiceName(voice) {
  return voice.name || 'é»˜è®¤å£°éŸ³';
}

// ç»Ÿä¸€çš„å‘éŸ³å‡½æ•°
function speak(text, type = 'chinese', speed = null) {
  if (!text) return;
  
  const config = PRONUNCIATION_CONFIG[type];
  if (!config) return;
  
  const rate = speed || config.currentSpeed;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = config.lang;
  u.rate = rate;
  u.pitch = config.pitch;
  u.volume = config.volume;
  
  // è®¾ç½®å‘éŸ³äºº
  const voices = getVoicesForType(type);
  if (voices.length > 0) {
    const voiceIndex = Math.min(config.voiceIndex, voices.length - 1);
    u.voice = voices[voiceIndex];
  }
  
  // å–æ¶ˆä»»ä½•æ­£åœ¨è¿›è¡Œçš„å‘éŸ³
  speechSynthesis.cancel();
  
  // å»¶è¿Ÿ50msåå‘éŸ³ï¼Œç¡®ä¿å–æ¶ˆæ“ä½œç”Ÿæ•ˆ
  setTimeout(() => {
    speechSynthesis.speak(u);
  }, 50);
}

// è®¾ç½®å‘éŸ³é€Ÿåº¦
function setPronunciationSpeed(type, speedKey) {
  const speeds = PRONUNCIATION_CONFIG[type]?.speeds;
  if (speeds && speeds[speedKey] !== undefined) {
    PRONUNCIATION_CONFIG[type].currentSpeed = speeds[speedKey];
    return speeds[speedKey];
  }
  return null;
}

// è·å–å½“å‰å‘éŸ³é€Ÿåº¦
function getPronunciationSpeed(type) {
  return PRONUNCIATION_CONFIG[type]?.currentSpeed;
}

// ==================== ç™»é™†/æ³¨å†Œæ¨¡å— ====================

function restoreUser() {
  const saved = localStorage.getItem("currentUser");
  if (saved) {
    currentUser = JSON.parse(saved);
    showAppPage();
  } else {
    showAuthPage();
  }
}

function switchAuthMode() {
  const loginPanel = document.getElementById("login-panel");
  const registerPanel = document.getElementById("register-panel");
  
  loginPanel.classList.toggle("active");
  registerPanel.classList.toggle("active");
  
  // æ¸…ç©ºé”™è¯¯ä¿¡æ¯å’Œè¡¨å•
  clearAuthErrors();
  document.getElementById("login-form").reset();
  document.getElementById("register-form").reset();
}

// ==================== èœå•é¡µé¢åˆ‡æ¢ ====================

function toggleChineseMenu(event) {
  event.stopPropagation();
  const submenu = document.getElementById("chineseSubmenu");
  submenu.style.display = submenu.style.display === "none" ? "flex" : "none";
}

function switchPage(page) {
  currentPage = page;
  const frameUrls = {
    'chinese': 'chinese.html',
    'pinyin': 'pinyin.html',
    'math': 'math.html',
    'english': 'english.html'
  };
  
  // æ›´æ–° iframe å†…å®¹
  if (frameUrls[page]) {
    document.getElementById("contentFrame").src = frameUrls[page];
  }
  
  // å…³é—­è¯­æ–‡å­èœå•
  const chineseSubmenu = document.getElementById("chineseSubmenu");
  if (chineseSubmenu) {
    chineseSubmenu.style.display = "none";
  }
  
  // æ›´æ–°èœå•æŒ‰é’®çš„æ´»è·ƒçŠ¶æ€
  const featureBtns = document.querySelectorAll(".feature-btn");
  featureBtns.forEach(btn => {
    if (btn.textContent.includes(
      page === 'chinese' || page === 'pinyin' ? 'è¯­æ–‡' : 
      page === 'math' ? 'æ•°å­¦' : 
      page === 'english' ? 'è‹±è¯­' : ''
    )) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });
  
  // æ›´æ–°å­èœå•æŒ‰é’®çš„æ´»è·ƒçŠ¶æ€
  const submenuItems = document.querySelectorAll(".submenu-item");
  submenuItems.forEach(btn => {
    if ((page === 'chinese' && btn.textContent === 'ç”Ÿå­—') ||
        (page === 'pinyin' && btn.textContent === 'å£°æ¯éŸµæ¯')) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });
}

function clearAuthErrors() {
  document.getElementById("login-error").classList.remove("show");
  document.getElementById("register-error").classList.remove("show");
}

function showAuthError(panelId, message) {
  const errorEl = document.getElementById(panelId === "login-panel" ? "login-error" : "register-error");
  errorEl.textContent = message;
  errorEl.classList.add("show");
}

async function handleLogin(event) {
  event.preventDefault();
  clearAuthErrors();
  
  const username = document.getElementById("login-username").value.trim();
  const password = document.getElementById("login-password").value.trim();

  if (!username || !password) {
    showAuthError("login-panel", "è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ");
    return;
  }

  try {
    const res = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (res.status === 200) {
      currentUser = { user_id: data.user_id, username: data.username };
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      document.getElementById("login-form").reset();
      showAppPage();
    } else {
      showAuthError("login-panel", data.error || "ç™»å½•å¤±è´¥");
    }
  } catch (err) {
    console.error("ç™»å½•è¯·æ±‚å‡ºé”™ï¼š", err);
    showAuthError("login-panel", "ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•");
  }
}

async function handleRegister(event) {
  event.preventDefault();
  clearAuthErrors();
  
  const username = document.getElementById("register-username").value.trim();
  const password = document.getElementById("register-password").value.trim();
  const confirm = document.getElementById("register-confirm").value.trim();

  if (!username || !password || !confirm) {
    showAuthError("register-panel", "è¯·å¡«å†™æ‰€æœ‰å­—æ®µ");
    return;
  }

  if (username.length < 3) {
    showAuthError("register-panel", "ç”¨æˆ·åè‡³å°‘éœ€è¦ 3 ä¸ªå­—ç¬¦");
    return;
  }

  if (password.length < 6) {
    showAuthError("register-panel", "å¯†ç è‡³å°‘éœ€è¦ 6 ä¸ªå­—ç¬¦");
    return;
  }

  if (password !== confirm) {
    showAuthError("register-panel", "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");
    return;
  }

  try {
    const res = await fetch("/api/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (res.status === 200) {
      alert("æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•");
      document.getElementById("register-form").reset();
      switchAuthMode(); // åˆ‡æ¢åˆ°ç™»å½•é¢æ¿
    } else {
      showAuthError("register-panel", data.error || "æ³¨å†Œå¤±è´¥");
    }
  } catch (err) {
    console.error("æ³¨å†Œè¯·æ±‚å‡ºé”™ï¼š", err);
    showAuthError("register-panel", "ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•");
  }
}

function showAuthPage() {
  document.getElementById("auth-page").style.display = "flex";
  document.getElementById("app-page").style.display = "none";
  // é‡ç½®ä¸ºç™»å½•é¢æ¿
  document.getElementById("login-panel").classList.add("active");
  document.getElementById("register-panel").classList.remove("active");
}

// ==================== ä¸»åº”ç”¨æ¨¡å— ====================

function showAppPage() {
  document.getElementById("auth-page").style.display = "none";
  document.getElementById("app-page").style.display = "block";
  document.getElementById("fabBtn").classList.add("show");
  updateUserMenu();
  switchPage("chinese");
}

function openAddItemModal() {
  // å£°æ¯éŸµæ¯é¡µé¢ä¸éœ€è¦æ·»åŠ æŒ‰é’®
  if (currentPage === 'pinyin') return;
  
  // æ ¹æ®å½“å‰é¡µé¢è®¾ç½®æ¨¡æ€æ¡†å†…å®¹
  const modalInputArea = document.getElementById("modalInputArea");
  const modalTitle = document.getElementById("modalTitle");
  
  if (currentPage === 'chinese') {
    modalTitle.textContent = "æ·»åŠ ç”Ÿå­—";
    modalInputArea.innerHTML = `
      <input type="text" id="addItemInput" placeholder="è¯·è¾“å…¥ç”Ÿå­—" maxlength="1" />
      <button onclick="saveChineseItem()">ä¿å­˜</button>
    `;
  } else if (currentPage === 'math') {
    modalTitle.textContent = "æ·»åŠ æ•°å­¦é¢˜";
    modalInputArea.innerHTML = `
      <input type="text" id="addItemInput" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹" />
      <button onclick="saveMathItem()">ä¿å­˜</button>
    `;
  } else if (currentPage === 'english') {
    modalTitle.textContent = "æ·»åŠ è‹±è¯­å•è¯";
    modalInputArea.innerHTML = `
      <input type="text" id="addItemInput" placeholder="è¯·è¾“å…¥è‹±æ–‡å•è¯" />
      <input type="text" id="addItemInput2" placeholder="è¯·è¾“å…¥ä¸­æ–‡ç¿»è¯‘" />
      <button onclick="saveEnglishItem()">ä¿å­˜</button>
    `;
  }
  
  document.getElementById("addItemModal").classList.add("show");
  document.getElementById("addItemInput").focus();
}

function closeAddItemModal(event) {
  if (event && event.target.id !== "addItemModal") return;
  document.getElementById("addItemModal").classList.remove("show");
}

// ==================== è¯­æ–‡æ¨¡å—å‡½æ•° ====================

function saveChineseItem() {
  const hanzi = document.getElementById("addItemInput").value.trim();
  if (!hanzi) return alert("è¯·è¾“å…¥ç”Ÿå­—");
  if (!currentUser) return alert("è¯·å…ˆç™»å½•");

  fetch("/api/words", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ user_id: currentUser.user_id, hanzi })
  }).then(res => {
    if (res.status === 409) {
      alert(`"${hanzi}" å·²ç»å­˜åœ¨äº†ï¼`);
    } else if (res.status === 200) {
      closeAddItemModal();
      // åˆ·æ–° iframe å†…å®¹
      document.getElementById("contentFrame").src = "chinese.html";
    } else {
      alert("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼");
    }
  }).catch(err => {
    console.error("è¯·æ±‚å‡ºé”™ï¼š", err);
    alert("ç½‘ç»œé”™è¯¯");
  });
}

// ==================== æ•°å­¦æ¨¡å—å‡½æ•° ====================

function saveMathItem() {
  const content = document.getElementById("addItemInput").value.trim();
  if (!content) return alert("è¯·è¾“å…¥é¢˜ç›®");
  alert("æ•°å­¦é¢˜ç›®åŠŸèƒ½å¼€å‘ä¸­...");
}

// ==================== è‹±è¯­æ¨¡å—å‡½æ•° ====================

function saveEnglishItem() {
  const word = document.getElementById("addItemInput").value.trim();
  const meaning = document.getElementById("addItemInput2").value.trim();
  if (!word || !meaning) return alert("è¯·è¾“å…¥å•è¯å’Œç¿»è¯‘");
  alert("è‹±è¯­å•è¯åŠŸèƒ½å¼€å‘ä¸­...");
}

// æ”¯æŒ Enter é”®åœ¨æ·»åŠ å†…å®¹æ¨¡æ€æ¡†ä¸­ä¿å­˜
document.addEventListener("keypress", (e) => {
  if (e.key === "Enter" && document.getElementById("addItemModal").classList.contains("show")) {
    if (currentPage === 'chinese') {
      saveChineseItem();
    } else if (currentPage === 'math') {
      saveMathItem();
    } else if (currentPage === 'english') {
      saveEnglishItem();
    }
  }
});

// ==================== å‘éŸ³è®¾ç½®å‡½æ•° ====================

function openPronunciationSettings() {
  closeUserMenu();
  const modal = document.getElementById("pronunciationModal");
  modal.classList.add("show");
  
  // åˆå§‹åŒ–å‘éŸ³äººé€‰æ‹©å™¨
  initializeVoiceSelectors();
  
  // æ›´æ–°æ‰€æœ‰æŒ‰é’®çŠ¶æ€
  updatePronunciationButtonStates();
}

// åˆå§‹åŒ–æ‰€æœ‰å‘éŸ³äººé€‰æ‹©å™¨
function initializeVoiceSelectors() {
  initializeVoiceSelector('chinese', 'chineseVoiceSelect');
  initializeVoiceSelector('pinyin', 'pinyinVoiceSelect');
  initializeVoiceSelector('english', 'englishVoiceSelect');
}

// åˆå§‹åŒ–å•ä¸ªå‘éŸ³äººé€‰æ‹©å™¨
function initializeVoiceSelector(type, selectId) {
  const select = document.getElementById(selectId);
  if (!select) return;
  
  const voices = getVoicesForType(type);
  select.innerHTML = '';
  
  if (voices.length === 0) {
    const option = document.createElement('option');
    option.value = '';
    option.textContent = 'æš‚æ— å¯ç”¨å£°éŸ³';
    select.appendChild(option);
    return;
  }
  
  voices.forEach((voice, index) => {
    const option = document.createElement('option');
    option.value = index;
    const lang = voice.lang.substring(0, 2).toUpperCase();
    option.textContent = `${getVoiceName(voice)} (${lang})`;
    select.appendChild(option);
  });
  
  // è®¾ç½®å½“å‰é€‰ä¸­çš„å‘éŸ³äºº
  const currentVoiceIndex = PRONUNCIATION_CONFIG[type].voiceIndex;
  select.value = currentVoiceIndex;
}

function closePronunciationSettings(event) {
  // å¦‚æœç‚¹å‡»äº†å†…å®¹åŒºåŸŸï¼Œç›´æ¥è¿”å›
  if (event && event.target.closest('.modal-content')) return;
  document.getElementById("pronunciationModal").classList.remove("show");
}

function updatePronunciationButtonStates() {
  // æ›´æ–°ä¸­æ–‡æŒ‰é’®çŠ¶æ€
  const chineseSpeed = getPronunciationSpeed('chinese');
  const chineseSpeedKey = Object.keys(PRONUNCIATION_CONFIG.chinese.speeds).find(
    key => PRONUNCIATION_CONFIG.chinese.speeds[key] === chineseSpeed
  );
  document.querySelectorAll('.pronunciation-type')[0].querySelectorAll('.speed-btn').forEach((btn, idx) => {
    btn.classList.toggle('active', 
      btn.textContent.includes('å¾ˆæ…¢') && chineseSpeedKey === 'slow' ||
      btn.textContent.includes('æ­£å¸¸') && chineseSpeedKey === 'normal' ||
      btn.textContent.includes('å¿«é€Ÿ') && chineseSpeedKey === 'fast'
    );
  });

  // æ›´æ–°æ‹¼éŸ³æŒ‰é’®çŠ¶æ€
  const pinyinSpeed = getPronunciationSpeed('pinyin');
  const pinyinSpeedKey = Object.keys(PRONUNCIATION_CONFIG.pinyin.speeds).find(
    key => PRONUNCIATION_CONFIG.pinyin.speeds[key] === pinyinSpeed
  );
  document.querySelectorAll('.pronunciation-type')[1].querySelectorAll('.speed-btn').forEach((btn, idx) => {
    btn.classList.toggle('active',
      btn.textContent.includes('å¾ˆæ…¢') && pinyinSpeedKey === 'slow' ||
      btn.textContent.includes('æ­£å¸¸') && pinyinSpeedKey === 'normal' ||
      btn.textContent.includes('å¿«é€Ÿ') && pinyinSpeedKey === 'fast'
    );
  });

  // æ›´æ–°è‹±æ–‡æŒ‰é’®çŠ¶æ€
  const englishSpeed = getPronunciationSpeed('english');
  const englishSpeedKey = Object.keys(PRONUNCIATION_CONFIG.english.speeds).find(
    key => PRONUNCIATION_CONFIG.english.speeds[key] === englishSpeed
  );
  document.querySelectorAll('.pronunciation-type')[2].querySelectorAll('.speed-btn').forEach((btn, idx) => {
    btn.classList.toggle('active',
      btn.textContent.includes('å¾ˆæ…¢') && englishSpeedKey === 'slow' ||
      btn.textContent.includes('æ­£å¸¸') && englishSpeedKey === 'normal' ||
      btn.textContent.includes('å¿«é€Ÿ') && englishSpeedKey === 'fast'
    );
  });
}

function setPronunciationSpeedUI(type, speedKey) {
  setPronunciationSpeed(type, speedKey);
  
  // æ›´æ–°æŒ‰é’®çŠ¶æ€
  const types = ['chinese', 'pinyin', 'english'];
  const typeIndex = types.indexOf(type);
  if (typeIndex >= 0) {
    const typeElement = document.querySelectorAll('.pronunciation-type')[typeIndex];
    if (typeElement) {
      typeElement.querySelectorAll('.speed-btn').forEach(btn => {
        btn.classList.remove('active');
        if (
          (btn.textContent.includes('å¾ˆæ…¢') && speedKey === 'slow') ||
          (btn.textContent.includes('æ­£å¸¸') && speedKey === 'normal') ||
          (btn.textContent.includes('å¿«é€Ÿ') && speedKey === 'fast')
        ) {
          btn.classList.add('active');
        }
      });
    }
  }
}

// è®¾ç½®å‘éŸ³äºº
function setVoiceUI(type, voiceIndex) {
  if (voiceIndex !== '' && voiceIndex !== undefined && voiceIndex !== null) {
    PRONUNCIATION_CONFIG[type].voiceIndex = parseInt(voiceIndex);
  }
}

function testPronunciation(text, type) {
  speak(text, type);
}

// ==================== ç”¨æˆ·èœå•å‡½æ•° ====================

function toggleUserMenu() {
  const userMenu = document.getElementById("userMenu");
  userMenu.classList.toggle("show");
}

function closeUserMenu() {
  const userMenu = document.getElementById("userMenu");
  userMenu.classList.remove("show");
}

function updateUserMenu() {
  const usernameDisplay = document.getElementById("usernameDisplay");
  if (currentUser) {
    usernameDisplay.textContent = `ğŸ‘¤ ${currentUser.username}`;
  }
}

function logout() {
  localStorage.removeItem("currentUser");
  currentUser = null;
  showAuthPage();
}

function openChangePassword() {
  alert("å¯†ç ä¿®æ”¹åŠŸèƒ½å¼€å‘ä¸­...");
}

// å…¨å±€ç‚¹å‡»ç›‘å¬ - ç‚¹å‡»èœå•å¤–éƒ¨æ—¶å…³é—­èœå•
document.addEventListener("click", (e) => {
  const userMenuBtn = document.getElementById("userMenuBtn");
  const userMenu = document.getElementById("userMenu");
  const chineseSubmenu = document.getElementById("chineseSubmenu");
  
  // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯èœå•æŒ‰é’®æˆ–èœå•æœ¬èº«ï¼Œåˆ™å…³é—­ç”¨æˆ·èœå•
  if (userMenu.classList.contains("show") && 
      !userMenuBtn.contains(e.target) && 
      !userMenu.contains(e.target)) {
    closeUserMenu();
  }
  
  // å…³é—­è¯­æ–‡å­èœå•
  if (chineseSubmenu && chineseSubmenu.style.display !== "none") {
    const chineseNavArea = e.target.closest('.feature-nav div[style*="position"]');
    if (!chineseNavArea) {
      chineseSubmenu.style.display = "none";
    }
  }
});

// åˆå§‹åŒ–
restoreUser();
</script>
</body>
</html>
