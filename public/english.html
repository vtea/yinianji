<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ëã±ËØ≠ - ËØçÊ±áÂ≠¶‰π†</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Microsoft YaHei", sans-serif;
      background: #fff3e0;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 16px;
    }

    .level-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .level-btn {
      padding: 8px 16px;
      border: 2px solid #ddd;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .level-btn:hover {
      border-color: #4caf50;
      color: #4caf50;
    }

    .level-btn.active {
      background: #4caf50;
      color: white;
      border-color: #4caf50;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin: 16px 0 12px 0;
      border-bottom: 2px solid #4caf50;
      padding-bottom: 8px;
    }

    .word-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 16px;
    }

    .word-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-height: 100px;
    }

    .word-card:hover {
      border-color: #4caf50;
      background: #f0f8f5;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .word-card.learned {
      border-color: #4caf50;
      background: #e8f5e9;
    }

    .word-english {
      font-size: 16px;
      font-weight: bold;
      color: #4caf50;
    }

    .word-chinese {
      font-size: 12px;
      color: #666;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .word-card:hover .word-chinese,
    .word-card.learned .word-chinese {
      opacity: 1;
    }

    .learn-count {
      font-size: 10px;
      color: #999;
      background: #f5f5f5;
      padding: 2px 4px;
      border-radius: 3px;
    }

    .empty-message {
      text-align: center;
      color: #888;
      padding: 40px 16px;
      font-size: 14px;
    }

    @media (max-width: 480px) {
      .word-list {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .container {
        padding: 12px;
      }
    }

    @media (min-width: 481px) and (max-width: 768px) {
      .word-list {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 769px) {
      .word-list {
        grid-template-columns: repeat(4, 1fr);
      }
    }
  </style>
</head>

<body>
<div class="container">
  <div class="level-selector" id="levelSelector"></div>
  <div id="contentArea"></div>
</div>

<script>
const currentUser = JSON.parse(localStorage.getItem("currentUser"));

// Ëã±ËØ≠ËØçÊ±áÂ∫ì - ÊåâÈöæÂ∫¶ÂàÜÁ∫ß
const englishVocabulary = {
  'beginner': {
    name: 'Â∞èÁôΩÂÖ•Èó®',
    words: [
      { english: 'hello', chinese: '‰Ω†Â•Ω' },
      { english: 'goodbye', chinese: 'ÂÜçËßÅ' },
      { english: 'yes', chinese: 'ÊòØÁöÑ' },
      { english: 'no', chinese: '‰∏çÊòØ' },
      { english: 'please', chinese: 'ËØ∑' },
      { english: 'thank you', chinese: 'Ë∞¢Ë∞¢‰Ω†' },
      { english: 'sorry', chinese: 'ÂØπ‰∏çËµ∑' },
      { english: 'ok', chinese: 'Â•ΩÁöÑ' },
      { english: 'my', chinese: 'ÊàëÁöÑ' },
      { english: 'you', chinese: '‰Ω†' },
      { english: 'he', chinese: '‰ªñ' },
      { english: 'she', chinese: 'Â•π' },
      { english: 'mom', chinese: 'Â¶àÂ¶à' },
      { english: 'dad', chinese: 'Áà∏Áà∏' },
      { english: 'apple', chinese: 'ËãπÊûú' },
      { english: 'cat', chinese: 'Áå´' },
      { english: 'dog', chinese: 'Áãó' },
      { english: 'sun', chinese: 'Â§™Èò≥' },
      { english: 'moon', chinese: 'Êúà‰∫Æ' },
      { english: 'water', chinese: 'Ê∞¥' },
    ]
  },
  'grade1': {
    name: '1Âπ¥Á∫ß',
    words: [
      { english: 'book', chinese: '‰π¶' },
      { english: 'pen', chinese: 'Á¨î' },
      { english: 'pencil', chinese: 'ÈìÖÁ¨î' },
      { english: 'table', chinese: 'Ê°åÂ≠ê' },
      { english: 'chair', chinese: 'Ê§ÖÂ≠ê' },
      { english: 'room', chinese: 'ÊàøÈó¥' },
      { english: 'school', chinese: 'Â≠¶Ê†°' },
      { english: 'teacher', chinese: 'ËÄÅÂ∏à' },
      { english: 'student', chinese: 'Â≠¶Áîü' },
      { english: 'friend', chinese: 'ÊúãÂèã' },
      { english: 'red', chinese: 'Á∫¢Ëâ≤' },
      { english: 'blue', chinese: 'ËìùËâ≤' },
      { english: 'green', chinese: 'ÁªøËâ≤' },
      { english: 'yellow', chinese: 'ÈªÑËâ≤' },
      { english: 'big', chinese: 'Â§ßÁöÑ' },
      { english: 'small', chinese: 'Â∞èÁöÑ' },
      { english: 'one', chinese: '‰∏Ä' },
      { english: 'two', chinese: '‰∫å' },
      { english: 'three', chinese: '‰∏â' },
      { english: 'four', chinese: 'Âõõ' },
      { english: 'five', chinese: '‰∫î' },
      { english: 'good', chinese: 'Â•ΩÁöÑ' },
      { english: 'bad', chinese: 'ÂùèÁöÑ' },
      { english: 'happy', chinese: 'Âø´‰πêÁöÑ' },
      { english: 'sad', chinese: '‰º§ÂøÉÁöÑ' },
    ]
  },
  'grade2': {
    name: '2Âπ¥Á∫ß',
    words: [
      { english: 'bread', chinese: 'Èù¢ÂåÖ' },
      { english: 'milk', chinese: 'ÁâõÂ•∂' },
      { english: 'rice', chinese: 'Á±≥È•≠' },
      { english: 'chicken', chinese: 'È∏°ËÇâ' },
      { english: 'fish', chinese: 'È±º' },
      { english: 'egg', chinese: 'È∏°Ëõã' },
      { english: 'orange', chinese: 'Ê©ôÂ≠ê' },
      { english: 'banana', chinese: 'È¶ôËïâ' },
      { english: 'strawberry', chinese: 'ËçâËéì' },
      { english: 'flower', chinese: 'Ëä±' },
      { english: 'tree', chinese: 'Ê†ë' },
      { english: 'grass', chinese: 'Ëçâ' },
      { english: 'sky', chinese: 'Â§©Á©∫' },
      { english: 'rain', chinese: 'Èõ®' },
      { english: 'snow', chinese: 'Èõ™' },
      { english: 'wind', chinese: 'È£é' },
      { english: 'cloud', chinese: '‰∫ë' },
      { english: 'star', chinese: 'ÊòüÊòü' },
      { english: 'bird', chinese: 'È∏ü' },
      { english: 'pig', chinese: 'Áå™' },
      { english: 'cow', chinese: 'Áâõ' },
      { english: 'horse', chinese: 'È©¨' },
      { english: 'run', chinese: 'Ë∑ë' },
      { english: 'walk', chinese: 'Ëµ∞' },
      { english: 'jump', chinese: 'Ë∑≥' },
    ]
  },
  'grade3': {
    name: '3Âπ¥Á∫ß',
    words: [
      { english: 'computer', chinese: 'ÁîµËÑë' },
      { english: 'telephone', chinese: 'ÁîµËØù' },
      { english: 'bicycle', chinese: 'Ëá™Ë°åËΩ¶' },
      { english: 'car', chinese: 'Ê±ΩËΩ¶' },
      { english: 'bus', chinese: 'ÂÖ¨‰∫§ËΩ¶' },
      { english: 'train', chinese: 'ÁÅ´ËΩ¶' },
      { english: 'plane', chinese: 'È£ûÊú∫' },
      { english: 'ship', chinese: 'Ëàπ' },
      { english: 'road', chinese: 'ÈÅìË∑Ø' },
      { english: 'bridge', chinese: 'Ê°•' },
      { english: 'building', chinese: 'Âª∫Á≠ëÁâ©' },
      { english: 'hospital', chinese: 'ÂåªÈô¢' },
      { english: 'library', chinese: 'Âõæ‰π¶È¶Ü' },
      { english: 'restaurant', chinese: 'È§êÂéÖ' },
      { english: 'market', chinese: 'Â∏ÇÂú∫' },
      { english: 'park', chinese: 'ÂÖ¨Âõ≠' },
      { english: 'beach', chinese: 'Êµ∑Êª©' },
      { english: 'mountain', chinese: 'Â±±' },
      { english: 'river', chinese: 'Ê≤≥' },
      { english: 'lake', chinese: 'Êπñ' },
      { english: 'morning', chinese: 'Êó©‰∏ä' },
      { english: 'afternoon', chinese: '‰∏ãÂçà' },
      { english: 'night', chinese: 'Êôö‰∏ä' },
      { english: 'winter', chinese: 'ÂÜ¨Â§©' },
      { english: 'summer', chinese: 'Â§èÂ§©' },
      { english: 'spring', chinese: 'Êò•Â§©' },
      { english: 'autumn', chinese: 'ÁßãÂ§©' },
    ]
  }
};

let currentLevel = 'beginner';

function speakWord(english) {
  if (!english) return;
  
  // Ë∞ÉÁî®Áà∂È°µÈù¢ÁöÑÁªü‰∏ÄÂèëÈü≥ÂáΩÊï∞
  if (window.parent && window.parent.speak) {
    window.parent.speak(english, 'english');
  } else {
    // Â§áÁî®ÊñπÊ°àÔºàÂ¶ÇÊûúÂú®Áã¨Á´ãÁéØÂ¢É‰∏≠Ôºâ
    const u = new SpeechSynthesisUtterance(english);
    u.lang = "en-US";
    u.rate = 0.8;
    speechSynthesis.cancel();
    setTimeout(() => {
      speechSynthesis.speak(u);
    }, 50);
  }
}

function recordLearn(english) {
  if (!currentUser) return;
  
  fetch("/api/english-learn", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ 
      user_id: currentUser.user_id, 
      word: english,
      level: currentLevel
    })
  }).catch(err => console.error("ËÆ∞ÂΩïÂ§±Ë¥•Ôºö", err));
}

function createWordCard(wordObj, learnCount = 0) {
  const card = document.createElement("div");
  card.className = "word-card" + (learnCount > 0 ? " learned" : "");
  card.innerHTML = `
    <div class="word-english">${wordObj.english}</div>
    <div class="word-chinese">${wordObj.chinese}</div>
    <div class="learn-count">üîä ${learnCount}</div>
  `;
  
  card.onclick = () => {
    speakWord(wordObj.english);
    recordLearn(wordObj.english);
    card.classList.add("learned");
    const countEl = card.querySelector(".learn-count");
    const count = parseInt(countEl.textContent.match(/\d+/)[0]);
    countEl.textContent = `üîä ${count + 1}`;
  };
  
  return card;
}

function renderLevel(level) {
  currentLevel = level;
  const data = englishVocabulary[level];
  const contentArea = document.getElementById("contentArea");
  
  contentArea.innerHTML = `
    <div class="section-title">${data.name} (${data.words.length}‰∏™ÂçïËØç)</div>
    <div class="word-list" id="wordList"></div>
  `;
  
  const wordList = document.getElementById("wordList");
  data.words.forEach(word => {
    wordList.appendChild(createWordCard(word, 0));
  });
}

function initLevelSelector() {
  const selector = document.getElementById("levelSelector");
  Object.keys(englishVocabulary).forEach(key => {
    const btn = document.createElement("button");
    btn.className = "level-btn" + (key === 'beginner' ? " active" : "");
    btn.textContent = englishVocabulary[key].name;
    btn.onclick = () => {
      document.querySelectorAll(".level-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderLevel(key);
    };
    selector.appendChild(btn);
  });
}

// ÂàùÂßãÂåñ
if (currentUser) {
  initLevelSelector();
  renderLevel('beginner');
} else {
  document.getElementById("contentArea").innerHTML = '<div class="empty-message">ËØ∑ÂÖàÁôªÂΩï</div>';
}
</script>
</body>
</html>
