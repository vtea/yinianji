<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ëã±ËØ≠ - ËØçÊ±áÂ≠¶‰π†</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Microsoft YaHei", sans-serif;
      background: #fff3e0;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 16px;
    }

    .level-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .level-btn {
      padding: 8px 16px;
      border: 2px solid #ddd;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .level-btn:hover {
      border-color: #4caf50;
      color: #4caf50;
    }

    .level-btn.active {
      background: #4caf50;
      color: white;
      border-color: #4caf50;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin: 16px 0 12px 0;
      border-bottom: 2px solid #4caf50;
      padding-bottom: 8px;
    }

    .word-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 16px;
    }

    .word-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-height: 100px;
    }

    .word-card:hover {
      border-color: #4caf50;
      background: #f0f8f5;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .word-card.learned {
      border-color: #4caf50;
      background: #e8f5e9;
    }

    .word-english {
      font-size: 16px;
      font-weight: bold;
      color: #4caf50;
    }

    .word-phonetic {
      font-size: 12px;
      color: #666;
      font-style: italic;
      font-family: Georgia, serif;
    }

    .word-chinese {
      font-size: 12px;
      color: #666;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .word-card:hover .word-chinese,
    .word-card.learned .word-chinese {
      opacity: 1;
    }

    .learn-count {
      font-size: 10px;
      color: #999;
      background: #f5f5f5;
      padding: 2px 4px;
      border-radius: 3px;
    }

    .empty-message {
      text-align: center;
      color: #888;
      padding: 40px 16px;
      font-size: 14px;
    }

    @media (max-width: 480px) {
      .word-list {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .container {
        padding: 12px;
      }
    }

    @media (min-width: 481px) and (max-width: 768px) {
      .word-list {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 769px) {
      .word-list {
        grid-template-columns: repeat(4, 1fr);
      }
    }
  </style>
</head>

<body>
<div class="container">
  <div class="level-selector" id="levelSelector"></div>
  <div id="contentArea"></div>
</div>

<script>
const currentUser = JSON.parse(localStorage.getItem("currentUser"));

// Ëã±ËØ≠ËØçÊ±áÂ∫ì - ÊåâÈöæÂ∫¶ÂàÜÁ∫ß
const englishVocabulary = {
  'beginner': {
    name: 'Â∞èÁôΩÂÖ•Èó®',
    words: [
      { english: 'hello', phonetic: '/h…ôÀàlo ä/', chinese: '‰Ω†Â•Ω' },
      { english: 'goodbye', phonetic: '/…° ädÀàba…™/', chinese: 'ÂÜçËßÅ' },
      { english: 'yes', phonetic: '/j…õs/', chinese: 'ÊòØÁöÑ' },
      { english: 'no', phonetic: '/no ä/', chinese: '‰∏çÊòØ' },
      { english: 'please', phonetic: '/pliÀêz/', chinese: 'ËØ∑' },
      { english: 'thank you', phonetic: '/Œ∏√¶≈ãk juÀê/', chinese: 'Ë∞¢Ë∞¢‰Ω†' },
      { english: 'sorry', phonetic: '/Ààs…ëÀêri/', chinese: 'ÂØπ‰∏çËµ∑' },
      { english: 'ok', phonetic: '/Àåo äÀàke…™/', chinese: 'Â•ΩÁöÑ' },
      { english: 'my', phonetic: '/ma…™/', chinese: 'ÊàëÁöÑ' },
      { english: 'you', phonetic: '/juÀê/', chinese: '‰Ω†' },
      { english: 'he', phonetic: '/hiÀê/', chinese: '‰ªñ' },
      { english: 'she', phonetic: '/ ÉiÀê/', chinese: 'Â•π' },
      { english: 'mom', phonetic: '/m…ëÀêm/', chinese: 'Â¶àÂ¶à' },
      { english: 'dad', phonetic: '/d√¶d/', chinese: 'Áà∏Áà∏' },
      { english: 'apple', phonetic: '/Àà√¶pl/', chinese: 'ËãπÊûú' },
      { english: 'cat', phonetic: '/k√¶t/', chinese: 'Áå´' },
      { english: 'dog', phonetic: '/d…îÀê…°/', chinese: 'Áãó' },
      { english: 'sun', phonetic: '/s ån/', chinese: 'Â§™Èò≥' },
      { english: 'moon', phonetic: '/muÀên/', chinese: 'Êúà‰∫Æ' },
      { english: 'water', phonetic: '/Ààw…îÀêt…ôr/', chinese: 'Ê∞¥' },
    ]
  },
  'grade1': {
    name: '1Âπ¥Á∫ß',
    words: [
      { english: 'book', phonetic: '/b äk/', chinese: '‰π¶' },
      { english: 'pen', phonetic: '/p…õn/', chinese: 'Á¨î' },
      { english: 'pencil', phonetic: '/Ààp…õnsl/', chinese: 'ÈìÖÁ¨î' },
      { english: 'table', phonetic: '/Ààte…™bl/', chinese: 'Ê°åÂ≠ê' },
      { english: 'chair', phonetic: '/t É…õr/', chinese: 'Ê§ÖÂ≠ê' },
      { english: 'room', phonetic: '/ruÀêm/', chinese: 'ÊàøÈó¥' },
      { english: 'school', phonetic: '/skuÀêl/', chinese: 'Â≠¶Ê†°' },
      { english: 'teacher', phonetic: '/ÀàtiÀêt É…ôr/', chinese: 'ËÄÅÂ∏à' },
      { english: 'student', phonetic: '/ÀàstuÀêd…ônt/', chinese: 'Â≠¶Áîü' },
      { english: 'friend', phonetic: '/fr…õnd/', chinese: 'ÊúãÂèã' },
      { english: 'red', phonetic: '/r…õd/', chinese: 'Á∫¢Ëâ≤' },
      { english: 'blue', phonetic: '/bluÀê/', chinese: 'ËìùËâ≤' },
      { english: 'green', phonetic: '/…°riÀên/', chinese: 'ÁªøËâ≤' },
      { english: 'yellow', phonetic: '/Ààj…õlo ä/', chinese: 'ÈªÑËâ≤' },
      { english: 'big', phonetic: '/b…™…°/', chinese: 'Â§ßÁöÑ' },
      { english: 'small', phonetic: '/sm…îÀêl/', chinese: 'Â∞èÁöÑ' },
      { english: 'one', phonetic: '/w ån/', chinese: '‰∏Ä' },
      { english: 'two', phonetic: '/tuÀê/', chinese: '‰∫å' },
      { english: 'three', phonetic: '/Œ∏riÀê/', chinese: '‰∏â' },
      { english: 'four', phonetic: '/f…îÀêr/', chinese: 'Âõõ' },
      { english: 'five', phonetic: '/fa…™v/', chinese: '‰∫î' },
      { english: 'good', phonetic: '/…° äd/', chinese: 'Â•ΩÁöÑ' },
      { english: 'bad', phonetic: '/b√¶d/', chinese: 'ÂùèÁöÑ' },
      { english: 'happy', phonetic: '/Ààh√¶pi/', chinese: 'Âø´‰πêÁöÑ' },
      { english: 'sad', phonetic: '/s√¶d/', chinese: '‰º§ÂøÉÁöÑ' },
    ]
  },
  'grade2': {
    name: '2Âπ¥Á∫ß',
    words: [
      { english: 'bread', phonetic: '/br…õd/', chinese: 'Èù¢ÂåÖ' },
      { english: 'milk', phonetic: '/m…™lk/', chinese: 'ÁâõÂ•∂' },
      { english: 'rice', phonetic: '/ra…™s/', chinese: 'Á±≥È•≠' },
      { english: 'chicken', phonetic: '/Ààt É…™k…ôn/', chinese: 'È∏°ËÇâ' },
      { english: 'fish', phonetic: '/f…™ É/', chinese: 'È±º' },
      { english: 'egg', phonetic: '/…õ…°/', chinese: 'È∏°Ëõã' },
      { english: 'orange', phonetic: '/Àà…îÀêr…™nd í/', chinese: 'Ê©ôÂ≠ê' },
      { english: 'banana', phonetic: '/b…ôÀàn√¶n…ô/', chinese: 'È¶ôËïâ' },
      { english: 'strawberry', phonetic: '/Ààstr…îÀêb…õri/', chinese: 'ËçâËéì' },
      { english: 'flower', phonetic: '/Ààfla ä…ôr/', chinese: 'Ëä±' },
      { english: 'tree', phonetic: '/triÀê/', chinese: 'Ê†ë' },
      { english: 'grass', phonetic: '/…°r√¶s/', chinese: 'Ëçâ' },
      { english: 'sky', phonetic: '/ska…™/', chinese: 'Â§©Á©∫' },
      { english: 'rain', phonetic: '/re…™n/', chinese: 'Èõ®' },
      { english: 'snow', phonetic: '/sno ä/', chinese: 'Èõ™' },
      { english: 'wind', phonetic: '/w…™nd/', chinese: 'È£é' },
      { english: 'cloud', phonetic: '/kla äd/', chinese: '‰∫ë' },
      { english: 'star', phonetic: '/st…ëÀêr/', chinese: 'ÊòüÊòü' },
      { english: 'bird', phonetic: '/b…úÀêrd/', chinese: 'È∏ü' },
      { english: 'pig', phonetic: '/p…™…°/', chinese: 'Áå™' },
      { english: 'cow', phonetic: '/ka ä/', chinese: 'Áâõ' },
      { english: 'horse', phonetic: '/h…îÀêrs/', chinese: 'È©¨' },
      { english: 'run', phonetic: '/r ån/', chinese: 'Ë∑ë' },
      { english: 'walk', phonetic: '/w…îÀêk/', chinese: 'Ëµ∞' },
      { english: 'jump', phonetic: '/d í åmp/', chinese: 'Ë∑≥' },
    ]
  },
  'grade3': {
    name: '3Âπ¥Á∫ß',
    words: [
      { english: 'computer', phonetic: '/k…ômÀàpjuÀêt…ôr/', chinese: 'ÁîµËÑë' },
      { english: 'telephone', phonetic: '/Ààt…õl…™fo än/', chinese: 'ÁîµËØù' },
      { english: 'bicycle', phonetic: '/Ààba…™s…™kl/', chinese: 'Ëá™Ë°åËΩ¶' },
      { english: 'car', phonetic: '/k…ëÀêr/', chinese: 'Ê±ΩËΩ¶' },
      { english: 'bus', phonetic: '/b ås/', chinese: 'ÂÖ¨‰∫§ËΩ¶' },
      { english: 'train', phonetic: '/tre…™n/', chinese: 'ÁÅ´ËΩ¶' },
      { english: 'plane', phonetic: '/ple…™n/', chinese: 'È£ûÊú∫' },
      { english: 'ship', phonetic: '/ É…™p/', chinese: 'Ëàπ' },
      { english: 'road', phonetic: '/ro äd/', chinese: 'ÈÅìË∑Ø' },
      { english: 'bridge', phonetic: '/br…™d í/', chinese: 'Ê°•' },
      { english: 'building', phonetic: '/Ààb…™ld…™≈ã/', chinese: 'Âª∫Á≠ëÁâ©' },
      { english: 'hospital', phonetic: '/Ààh…ëÀêsp…™tl/', chinese: 'ÂåªÈô¢' },
      { english: 'library', phonetic: '/Ààla…™br…õri/', chinese: 'Âõæ‰π¶È¶Ü' },
      { english: 'restaurant', phonetic: '/Ààr…õst…ôr…ëÀênt/', chinese: 'È§êÂéÖ' },
      { english: 'market', phonetic: '/Ààm…ëÀêrk…™t/', chinese: 'Â∏ÇÂú∫' },
      { english: 'park', phonetic: '/p…ëÀêrk/', chinese: 'ÂÖ¨Âõ≠' },
      { english: 'beach', phonetic: '/biÀêt É/', chinese: 'Êµ∑Êª©' },
      { english: 'mountain', phonetic: '/Ààma änt…ôn/', chinese: 'Â±±' },
      { english: 'river', phonetic: '/Ààr…™v…ôr/', chinese: 'Ê≤≥' },
      { english: 'lake', phonetic: '/le…™k/', chinese: 'Êπñ' },
      { english: 'morning', phonetic: '/Ààm…îÀêrn…™≈ã/', chinese: 'Êó©‰∏ä' },
      { english: 'afternoon', phonetic: '/Àå√¶ft…ôrÀànuÀên/', chinese: '‰∏ãÂçà' },
      { english: 'night', phonetic: '/na…™t/', chinese: 'Êôö‰∏ä' },
      { english: 'winter', phonetic: '/Ààw…™nt…ôr/', chinese: 'ÂÜ¨Â§©' },
      { english: 'summer', phonetic: '/Ààs åm…ôr/', chinese: 'Â§èÂ§©' },
      { english: 'spring', phonetic: '/spr…™≈ã/', chinese: 'Êò•Â§©' },
      { english: 'autumn', phonetic: '/Àà…îÀêt…ôm/', chinese: 'ÁßãÂ§©' },
    ]
  }
};

let currentLevel = 'beginner';

function speakWord(english) {
  if (!english) return;
  
  // Ë∞ÉÁî®Áà∂È°µÈù¢ÁöÑÁªü‰∏ÄÂèëÈü≥ÂáΩÊï∞
  if (window.parent && window.parent.speak) {
    window.parent.speak(english, 'english');
  } else {
    // Â§áÁî®ÊñπÊ°àÔºàÂ¶ÇÊûúÂú®Áã¨Á´ãÁéØÂ¢É‰∏≠Ôºâ
    const u = new SpeechSynthesisUtterance(english);
    u.lang = "en-US";
    u.rate = 0.8;
    speechSynthesis.cancel();
    setTimeout(() => {
      speechSynthesis.speak(u);
    }, 50);
  }
}

function recordLearn(english) {
  if (!currentUser) return;
  
  fetch("/api/english-learn", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ 
      user_id: currentUser.user_id, 
      word: english,
      level: currentLevel
    })
  }).catch(err => console.error("ËÆ∞ÂΩïÂ§±Ë¥•Ôºö", err));
}

function createWordCard(wordObj, learnCount = 0) {
  const card = document.createElement("div");
  card.className = "word-card" + (learnCount > 0 ? " learned" : "");
  card.innerHTML = `
    <div class="word-english">${wordObj.english}</div>
    <div class="word-phonetic">${wordObj.phonetic}</div>
    <div class="word-chinese">${wordObj.chinese}</div>
    <div class="learn-count">üîä ${learnCount}</div>
  `;
  
  card.onclick = () => {
    speakWord(wordObj.english);
    recordLearn(wordObj.english);
    card.classList.add("learned");
    const countEl = card.querySelector(".learn-count");
    const count = parseInt(countEl.textContent.match(/\d+/)[0]);
    countEl.textContent = `üîä ${count + 1}`;
  };
  
  return card;
}

function renderLevel(level) {
  currentLevel = level;
  const data = englishVocabulary[level];
  const contentArea = document.getElementById("contentArea");
  
  contentArea.innerHTML = `
    <div class="section-title">${data.name} (${data.words.length}‰∏™ÂçïËØç)</div>
    <div class="word-list" id="wordList"></div>
  `;
  
  const wordList = document.getElementById("wordList");
  data.words.forEach(word => {
    wordList.appendChild(createWordCard(word, 0));
  });
}

function initLevelSelector() {
  const selector = document.getElementById("levelSelector");
  Object.keys(englishVocabulary).forEach(key => {
    const btn = document.createElement("button");
    btn.className = "level-btn" + (key === 'beginner' ? " active" : "");
    btn.textContent = englishVocabulary[key].name;
    btn.onclick = () => {
      document.querySelectorAll(".level-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderLevel(key);
    };
    selector.appendChild(btn);
  });
}

// ÂàùÂßãÂåñ
if (currentUser) {
  initLevelSelector();
  renderLevel('beginner');
} else {
  document.getElementById("contentArea").innerHTML = '<div class="empty-message">ËØ∑ÂÖàÁôªÂΩï</div>';
}
</script>
</body>
</html>
