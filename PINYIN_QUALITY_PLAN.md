# 拼音准确性保障方案

## 问题分析
1. 部分生字的拼音音调不准确
2. 游戏结果显示的正确答案不对
3. 需要一个严谨的机制确保拼音数据质量

## 已实施的措施

### 1. 自动拼音生成（已有）
- 使用 `pinyin` npm 包自动生成带音调的拼音
- 在添加生字时自动调用：`pinyin(hanzi, { style: pinyin.STYLE_TONE })`

### 2. 数据源统一（刚修复）
- **问题**：前端显示答错题目时使用了前端缓存的数据
- **解决**：直接使用后端返回的数据库准确数据
- **修复点**：
  - 后端返回 `correct_pinyin` 字段（从数据库查询）
  - 前端直接使用 `item.correct_pinyin` 而非 `question.pinyin`

### 3. 返回用户选择的答案（刚修复）
- 后端返回结果中包含 `selected_pinyin` 字段
- 确保显示时能准确对比用户选择和正确答案

## 建议的进一步改进

### 方案 A：拼音编辑功能（推荐）
**实施步骤**：
1. 在生字卡片上添加"编辑"按钮
2. 点击后可以手动修改拼音
3. 提供常用拼音的快捷输入
4. 保存后更新数据库

**优点**：
- 灵活性高，用户可以纠正错误
- 适合特殊读音、多音字
- 实施简单

**缺点**：
- 需要用户手动操作
- 可能引入新的错误

### 方案 B：拼音质量检查工具
**实施步骤**：
1. 创建后台检查脚本
2. 遍历所有生字，重新生成拼音
3. 对比新旧拼音，标记差异
4. 提供批量更新功能

**优点**：
- 系统化解决问题
- 可以定期运行

**缺点**：
- pinyin 库本身可能有错误
- 无法处理多音字

### 方案 C：多音字支持（最严谨）
**实施步骤**：
1. 数据库添加 `pinyin_variants` 字段存储多个读音
2. 添加生字时提示可能的多个读音
3. 用户选择正确的读音
4. 游戏时使用用户确认的读音

**优点**：
- 最准确，适合教育场景
- 解决多音字问题

**缺点**：
- 实施复杂度高
- 需要更多用户交互

## 立即可用的验证方法

### 手动验证步骤
1. 在生字本中查看每个生字的拼音
2. 发现错误时记录下来
3. 使用数据库工具直接修改：
```sql
UPDATE words SET pinyin = '正确拼音' WHERE hanzi = '生字';
```

### 批量验证脚本（可选）
```javascript
// 运行此脚本检查和更新拼音
const pinyin = require('pinyin');
db.all("SELECT id, hanzi, pinyin FROM words", (err, words) => {
  words.forEach(word => {
    const correctPinyin = pinyin(word.hanzi, { style: pinyin.STYLE_TONE })[0][0];
    if (correctPinyin !== word.pinyin) {
      console.log(`${word.hanzi}: ${word.pinyin} -> ${correctPinyin}`);
      // 可选：自动更新
      // db.run("UPDATE words SET pinyin = ? WHERE id = ?", [correctPinyin, word.id]);
    }
  });
});
```

## 当前状态
✅ 修复了显示答错题目时使用错误数据源的问题
✅ 后端返回准确的数据库拼音
✅ 前端直接使用后端返回的准确数据

## 下一步建议
1. **短期**：测试当前修复是否解决显示问题
2. **中期**：实施方案 A（拼音编辑功能）
3. **长期**：考虑方案 C（多音字支持）

## 注意事项
- `pinyin` npm 包的准确率约 95-98%
- 多音字需要根据语境判断（如"长"：cháng/zhǎng）
- 生僻字可能无法正确识别
- 建议在添加生字时允许用户手动确认/修改拼音
