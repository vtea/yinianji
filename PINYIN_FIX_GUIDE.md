# 拼音修复指南

## 问题修复完成 ✅

### 已修复的问题
1. **答错题目显示不准确** - ✅ 已修复
   - 修改前：使用前端缓存的 `questions` 数组数据
   - 修改后：直接使用后端返回的数据库准确数据 (`item.correct_pinyin`)

2. **后端返回数据不完整** - ✅ 已修复
   - 添加了 `selected_pinyin` 字段，确保能准确对比

3. **拼音生成质量检查** - ✅ 已添加
   - 在生成拼音时添加了质量检查
   - 如果生成失败会输出警告信息

## 拼音质量检查工具

### 使用方法

#### 1. 检查拼音（不修改）
```bash
node check-pinyin.js
```
这会：
- 列出所有拼音可能有问题的生字
- 显示当前拼音和建议拼音
- 生成详细报告文件 `pinyin-check-report.json`

#### 2. 自动修复拼音
```bash
node check-pinyin.js --fix
```
⚠️ **注意**：此操作会直接修改数据库，建议先备份

### 手动修复拼音

如果发现特定生字的拼音不对，可以手动修改：

#### 方法 1：使用 SQLite 命令行
```bash
sqlite3 words.db
```
然后执行：
```sql
-- 查看某个生字的拼音
SELECT hanzi, pinyin FROM words WHERE hanzi = '长';

-- 修改拼音
UPDATE words SET pinyin = 'cháng' WHERE hanzi = '长' AND user_id = 1;

-- 退出
.quit
```

#### 方法 2：使用数据库管理工具
推荐工具：
- DB Browser for SQLite（免费，跨平台）
- TablePlus
- DBeaver

步骤：
1. 打开 `words.db` 文件
2. 找到 `words` 表
3. 找到需要修改的生字
4. 修改 `pinyin` 字段
5. 保存

## 多音字处理

### 常见多音字示例
- 长：cháng（长度）/ zhǎng（生长）
- 还：hái（还有）/ huán（归还）
- 种：zhǒng（种子）/ zhòng（种植）
- 差：chā（差别）/ chà（差劲）/ chāi（出差）/ cī（参差）
- 落：luò（落下）/ là（落下）/ lào（落枕）

### 处理建议
1. **查询实际使用的读音**
   ```sql
   SELECT hanzi, pinyin, user_id FROM words WHERE hanzi = '长';
   ```

2. **根据使用场景更新**
   - 如果是"长度"，使用 `cháng`
   - 如果是"成长"，使用 `zhǎng`

## 预防措施

### 添加生字时的最佳实践
1. 添加生字后，立即检查拼音是否正确
2. 特别注意多音字
3. 如有疑问，可以：
   - 查字典确认
   - 使用在线工具（如汉典网）
   - 咨询老师

### 定期检查
建议每周运行一次检查：
```bash
node check-pinyin.js
```

## 当前修复状态

| 问题 | 状态 | 说明 |
|------|------|------|
| 答错题目显示 | ✅ 已修复 | 使用数据库准确数据 |
| 拼音生成质量 | ✅ 已改进 | 添加质量检查 |
| 检查工具 | ✅ 已创建 | check-pinyin.js |
| 自动修复 | ✅ 可用 | --fix 参数 |
| 手动编辑 | 📋 计划中 | 未来功能 |

## 下一步计划

### 短期（可选）
- [ ] 在前端添加"编辑拼音"按钮
- [ ] 添加拼音预览功能

### 中期（可选）
- [ ] 支持多音字选择
- [ ] 添加拼音验证提示

### 长期（可选）
- [ ] 集成专业的汉字拼音库
- [ ] 添加语音验证功能

## 技术说明

### 拼音库准确率
- 使用的 `pinyin` npm 包
- 版本：4.0.0
- 准确率：约 95-98%
- 主要问题：多音字需要根据语境判断

### 数据存储
- 数据库表：`words`
- 拼音字段：`pinyin` (TEXT)
- 格式：带音调的拼音（如 "cháng"）
- 多字拼音：用空格分隔（如 "hǎo péng yǒu"）

## 需要帮助？

如果遇到问题：
1. 检查 `pinyin-check-report.json` 报告
2. 查看控制台的警告信息
3. 手动验证可疑的拼音
4. 必要时手动修正

## 更新日志

### 2024-01-19
- ✅ 修复答错题目显示问题
- ✅ 添加拼音质量检查
- ✅ 创建检查工具 check-pinyin.js
- ✅ 编写修复指南
